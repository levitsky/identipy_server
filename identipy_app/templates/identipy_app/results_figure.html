{% extends "base.html" %}
{% load stringfilter %}
{% block title %}Search results: {{ searchrun.searchgroup_parent.groupname|spacify }}/{{ searchrun.name|spacify}}{% endblock%}
{% block content %}
        <div id="tab">
        <form action="" method="post">{% csrf_token %}
        
        
            <h2> <p style="word-break:break-word">Search results: <input type="submit" class="link" value = {{ searchrun.searchgroup_parent.groupname|spacify }} name="search_details">/{{ searchrun.name|spacify}}</p></h2>
        
		{% if searchgroup %}
            <table id="processes_list" type="bordered">
                <tr id="headings">
                    <th>Search name</th>
                    <th>PSMs</th>
                    <th>Peptides</th>
                    <th>Proteins</th>
                    <th>FDR, %</th>
                    <th>FDR type</th>
                    <th>MS/MS</th>
                    <th>Unfiltered PSMs</th>
                    
                    
                </tr>
            <tr>
            <td class="td1" style="word-break:break-word">{{ searchrun.name|spacify }}</td>
            {% if searchrun.numPSMs %}
                <td class="td2"><input type="submit" class="link" value={{ searchrun.numPSMs }} name="show_psms"></td>
                <td class="td2"><input type="submit" class="link" value={{ searchrun.numPeptides }} name="show_peptides"></td>
                <td class="td2"><input type="submit" class="link" value={{ searchrun.numProteins }} name="show_proteins"></td>
		    {% else %}
                <td class="td2">{{ searchrun.numPSMs }}</td>
                <td class="td2">{{ searchrun.numPeptides }}</td>
                <td class="td2">{{ searchrun.numProteins }}</td>
		    {% endif %}
            <td class="td2">{{ searchrun.fdr_psms }}</td>
            <td class="td2">{{ searchrun.fdr_type }}</td>
            <td class="td2">{{ searchrun.numMSMS }}</td>
            <td class="td2">{{ searchrun.totalPSMs }}</td>
            </tr>
            </table>
		{% else %}
			<p>There are no searches</p>
		{% endif %}


        <input type="hidden" name="results_figure_actualname" value={{ searchrun.runname|spacify }}>
        <input type="hidden" name="results_figure_searchgroupid" value={{ searchrun.searchgroup_parent.id }}>
    	{% if searchrun.totalPSMs %}
        <div id="colored">
            Download:
        <input type="submit" class="btn" value="csv files" name="download_csv">
        
        <input type="submit" class="btn" value="pepxml files" name="download_pepxml">
        <input type="submit" class="btn" value="mgf files" name="download_mgf"><br>
        <input type="submit" class="btn" value="figures in png format" name="download_figs">
        <input type="submit" class="btn" value="figures in svg format" name="download_figs_svg">
        <input type="submit" class="btn" value="show parameters" name="showparams">
       </form> 
            </div>
        <div class = "vert_block" >
			<div id="img_list">
            <h2>PSM distributions</h2>
            {% for doc in searchrun.get_PSMdistrimagefiles %}

            <div class="floated_img">
                <img src="{{ doc.docfile.url }}" />
            </div>
			{% endfor %}
                <h2>Peptide distributions</h2>
			{% for doc in searchrun.get_distrimagefiles %}

            <div class="floated_img">
                <img src="{{ doc.docfile.url }}" />
            </div>
			{% endfor %}
            <h2>Label-free quantitation</h2>
			{% for doc in searchrun.get_quantimagefiles %}

            <div class="floated_img">
                <img src="{{ doc.docfile.url }}" />
            </div>
			{% endfor %}
                {% load staticfiles %}
                <h2>MP-score descriptors</h2>
                <img id="legend" src="{% static 'image/legend.png' %}" />
			{% for doc in searchrun.get_mpimagefiles %}

            <div class="floated_img">
                <img src="{{ doc.docfile.url }}" />
            </div>
			{% endfor %}
			</div>
            
		{% endif %}
        </div>
        <div id="get_status">
            <a class="backbtn" href="{% url 'identipy_app:getstatus' %}">Back to search history</a>
        </div>
           

</div>
{% endblock %}
