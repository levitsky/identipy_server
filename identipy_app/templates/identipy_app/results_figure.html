{% extends "base.html" %}
{% load stringfilter %}
{% block title %}Search results: {{ searchrun.searchgroup_parent.groupname|spacify }}/{{ searchrun.name|spacify}}{% endblock%}
{% block content %}
        <div id="tab">
        <form action="" method="post">{% csrf_token %}
        
        
            <h2> <p style="word-break:break-word">Search results: <input type="submit" class="link" value = {{ searchrun.searchgroup_parent.groupname|spacify }} name="search_details">/{{ searchrun.name|spacify}}</p></h2>
        
		{% if searchgroup %}
            <table id="processes_list" type="bordered">
                <tr id="headers">
                    <th>Search name</th>
                    <th>PSMs</th>
                    <th>Peptides</th>
                    <th>Proteins</th>
                    <th>FDR, %</th>
                    <th>FDR type</th>
                    <th>MS/MS</th>
                    <th>Unfiltered PSMs</th>
                    
                    
                </tr>
            <tr>
            <td class="td1" style="word-break:break-word">{{ searchrun.name|spacify }}</td>
            {% if searchrun.numPSMs %}
                <td><a class="td2" class="link" value={{ searchrun.numPSMs }} href="{% url 'identipy_app:show' %}?show_type=psm">{{ searchrun.numPSMs }}</a></td>
                <td><a class="td2" class="link" href="{% url 'identipy_app:show' %}?show_type=peptide">{{ searchrun.numPeptides }}</a></td>
                <td><a class="td2" class="link" href="{% url 'identipy_app:show' %}?show_type=protein">{{ searchrun.numProteins }}</a></td>
		    {% else %}
                <td class="td2">{{ searchrun.numPSMs }}</td>
                <td class="td2">{{ searchrun.numPeptides }}</td>
                <td class="td2">{{ searchrun.numProteins }}</td>
		    {% endif %}
            <td class="td2">{{ searchrun.fdr_psms }}</td>
            <td class="td2">{{ searchrun.fdr_type }}</td>
            <td class="td2">{{ searchrun.numMSMS }}</td>
            <td class="td2">{{ searchrun.totalPSMs }}</td>
            </tr>
            </table>
		{% else %}
			<p>There are no searches</p>
		{% endif %}


        <input type="hidden" name="results_figure_actualname" value={{ searchrun.runname|spacify }}>
        <input type="hidden" name="results_figure_searchgroupid" value={{ searchrun.searchgroup_parent.id }}>
    	{% if searchrun.totalPSMs %}
        <div id="colored" class="centered">
            Download:
        <a class="btn" href="{% url 'identipy_app:download' %}?down_type=csv">csv files</a>
        <a class="btn" href="{% url 'identipy_app:download' %}?down_type=pepxml">pepxml files</a>
        <a class="btn" href="{% url 'identipy_app:download' %}?down_type=mgf">mgf files</a>
        <a class="btn" href="{% url 'identipy_app:download' %}?down_type=figs">figures in png format</a>
        <a class="btn" href="{% url 'identipy_app:download' %}?down_type=figs_svg">figures in svg format</a>
        <input type="submit" class="btn" value="show parameters" name="showparams">
       
            </div>
        <div class = "vert_block" >
			<div id="img_list">
            <h2>PSM distributions</h2>
            {% for doc in searchrun.get_PSMdistrimagefiles %}

            <div class="floated_img">
                <img src="{{ doc.docfile.url }}" />
            </div>
			{% endfor %}
                <h2>Peptide distributions</h2>
			{% for doc in searchrun.get_distrimagefiles %}

            <div class="floated_img">
                <img src="{{ doc.docfile.url }}" />
            </div>
			{% endfor %}
            <h2>Label-free quantitation</h2>
			{% for doc in searchrun.get_quantimagefiles %}

            <div class="floated_img">
                <img src="{{ doc.docfile.url }}" />
            </div>
			{% endfor %}
                {% load staticfiles %}
                <h2>MP-score descriptors
                <img id="legend" src="{% static 'image/legend.png' %}" /></h2>
			{% for doc in searchrun.get_mpimagefiles %}

            <div class="floated_img">
                <img src="{{ doc.docfile.url }}" />
            </div>
			{% endfor %}
			</div>
            
		{% endif %}
        </div>
        <div id="get_status" class="centered">
            <a class="backbtn" href="{% url 'identipy_app:getstatus' %}">Back to search history</a>
        </div>
           

</div>
{% endblock %}
